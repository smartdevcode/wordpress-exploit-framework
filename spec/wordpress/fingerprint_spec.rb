require_relative '../spec_helper'

describe Wpxf::WordPress::Fingerprint do
  # Dummy class for tests.
  class Subject < Wpxf::Module
    include Wpxf::Net::HttpClient
    include Wpxf::WordPress::Options
    include Wpxf::WordPress::Urls
    include Wpxf::WordPress::Fingerprint
  end

  let(:body) { '' }
  let(:code) { 200 }
  let(:subject) do
    subject = Subject.new
    subject.set_option_value('host', '127.0.0.1')
    subject.set_option_value('target_uri', '/wp/')
    subject
  end

  before :each do
    res = { body: body, code: code }
    allow(subject).to receive(:execute_get_request).and_return(res)
  end

  describe '#wordpress_and_online?' do
    let(:body) do
      '<head><link rel="pingback" href="http://192.168.1.15/wordpress/'\
      'xmlrpc.php"></head>'
    end

    it 'returns true if a valid WordPress fingerprint can be found' do
      expect(subject.wordpress_and_online?).to be true
    end
  end
end
