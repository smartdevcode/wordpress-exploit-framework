require_relative '../spec_helper'

describe Wpxf::WordPress::ShellUpload do
  let(:subject) do
    Class.new(Wpxf::Module) do
      include Wpxf::WordPress::ShellUpload
    end.new
  end

  let(:subject_with_auth) do
    Class.new(Wpxf::Module) do
      include Wpxf::WordPress::ShellUpload

      def requires_authentication
        true
      end
    end.new
  end

  describe '#new' do
    it 'registers the payload_name_length option' do
      expect(subject.get_option('payload_name_length')).to_not be_nil
    end

    context 'when requires_authentication is true' do
      it 'registers the username and password options' do
        expect(subject_with_auth.get_option('username')).to_not be_nil
        expect(subject_with_auth.get_option('password')).to_not be_nil
      end
    end

    context 'when requires_authentication is false' do
      it 'does not register the username and password options' do
        expect(subject.get_option('username')).to be_nil
        expect(subject.get_option('password')).to be_nil
      end
    end
  end
end
