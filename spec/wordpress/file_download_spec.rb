require_relative '../spec_helper'

describe Wpxf::WordPress::FileDownload do
  let(:export_path_required) { false }
  let(:subject) do
    c = Class.new(Wpxf::Module) do
      include Wpxf::WordPress::FileDownload
    end

    expect_any_instance_of(c).to receive(:export_path_required).and_return(export_path_required)
    c.new
  end

  describe '#new' do
    it 'registers the remote_file option' do
      expect(subject.get_option('remote_file')).to_not be_nil
    end

    it 'registers the export_path option' do
      expect(subject.get_option('export_path')).to_not be_nil
    end

    it 'sets the export_path option to not be required by default' do
      expect(subject.get_option('export_path').required?).to be false
    end

    describe 'when #export_path_required returns true' do
      let(:export_path_required) { true }
      it 'sets the export_path option to be required' do
        expect(subject.get_option('export_path').required?).to be true
      end
    end
  end

  describe '#run' do
    it 'raises an error if #working_directory is not implemented' do
      expect { subject.run }.to raise_error(
        'A value must be specified for #working_directory'
      )
    end
  end
end
