#!/usr/bin/env ruby

require 'fileutils'
require_relative 'env'
require 'cli/console'

puts '                           _'
puts '    __      _____  _ __ __| |_ __  _ __ ___  ___ ___'
puts '    \ \ /\ / / _ \| \'__/ _` | \'_ \| \'__/ _ \/ __/ __|'
puts '     \ V  V / (_) | | | (_| | |_) | | |  __/\__ \__ \\'
puts '      \_/\_/ \___/|_|  \__,_| .__/|_|  \___||___/___/'
puts '                            |_|'
puts '                              _       _ _'
puts '               _____  ___ __ | | ___ (_) |_'
puts '              / _ \ \/ / \'_ \| |/ _ \| | __|'
puts '             |  __/>  <| |_) | | (_) | | |_'
puts '              \___/_/\_\ .__/|_|\___/|_|\__|'
puts '                       |_|'
puts '    __                                             _'
puts '   / _|_ __ __ _ _ __ ___   _____      _____  _ __| | __'
puts '  | |_| \'__/ _` | \'_ ` _ \ / _ \ \ /\ / / _ \| \'__| |/ /'
puts '  |  _| | | (_| | | | | | |  __/\ V  V / (_) | |  |   <'
puts '  |_| |_|  \__,_|_| |_| |_|\___| \_/\_/ \___/|_|  |_|\_\\'
puts

console = Cli::Console.new
puts "   Loaded #{Wpxf::Auxiliary.module_list.size} auxiliary modules, "\
     "#{Wpxf::Exploit.module_list.size} exploits, "\
     "#{Wpxf::Payloads.payload_count} payloads"
puts

Dir.chdir(Dir.tmpdir) do
  temp_directories = Dir.glob('wpxf_*')
  if temp_directories.length > 0
    print '[!] '.yellow
    puts "#{temp_directories.length} temporary files were found that "\
         'appear to no longer be needed.'
    print '    Would you like to remove these files? [y/n]: '
    temp_directories.each { |d| FileUtils.rm_r(d) } if gets.chomp =~ /^y$/i
    puts
  end
end

console.start
